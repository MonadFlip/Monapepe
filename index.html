<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>StakeTokenETH DApp</title>
  <!-- Ethers.js library from jsDelivr -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" type="application/javascript"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { padding: 8px; margin: 5px 0; }
    .section { margin-bottom: 20px; }
  </style>
</head>
<body>
  <h1>StakeTokenETH DApp</h1>
  <button id="connectWallet">Connect Wallet</button>
  <div id="walletAddress"></div>

  <div class="section">
    <h2>Contract Info</h2>
    <button id="refreshData">Refresh Data</button>
    <p>Staked Amount: <span id="stakedAmount">0</span></p>
    <p>Pending Reward: <span id="pendingReward">0</span></p>
    <p>Contract Balance: <span id="contractBalance">0</span></p>
  </div>

  <div class="section">
    <h2>Actions</h2>
    <div>
      <h3>Stake Token</h3>
      <input type="number" id="stakeAmount" placeholder="Amount to stake">
      <button id="stakeButton">Stake</button>
    </div>
    <div>
      <h3>Unstake Token</h3>
      <input type="number" id="unstakeAmount" placeholder="Amount to unstake">
      <button id="unstakeButton">Unstake</button>
    </div>
    <div>
      <h3>Claim Reward</h3>
      <button id="claimRewardButton">Claim Reward</button>
    </div>
    <div>
      <h3>Emergency Withdraw</h3>
      <button id="emergencyWithdrawButton">Emergency Withdraw</button>
    </div>
  </div>

  <script>
    let provider;
    let signer;
    let contract;
    let userAddress;

    // Contract information
    const contractAddress = "YOUR_CONTRACT_ADDRESS"; // Replace with your deployed contract address
    const abi = [
      "function stake(uint256 amount) external",
      "function unstake(uint256 amount) external",
      "function claimReward() external",
      "function emergencyWithdraw() external",
      "function pendingReward(address user) external view returns (uint256)",
      "function getStakedAmount(address user) external view returns (uint256)",
      "function contractBalance() external view returns (uint256)"
    ];

    // Connect to MetaMask wallet
    async function connectWallet() {
      if (window.ethereum) {
        try {
          await window.ethereum.request({ method: "eth_requestAccounts" });
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          userAddress = await signer.getAddress();
          document.getElementById("walletAddress").innerText = "Connected: " + userAddress;
          contract = new ethers.Contract(contractAddress, abi, signer);
          refreshData();
        } catch (error) {
          console.error(error);
          alert("Failed to connect wallet.");
        }
      } else {
        alert("Please install MetaMask.");
      }
    }

    // Refresh contract data
    async function refreshData() {
      if (!contract || !userAddress) return;
      try {
        const staked = await contract.getStakedAmount(userAddress);
        const pending = await contract.pendingReward(userAddress);
        const balance = await contract.contractBalance();
        document.getElementById("stakedAmount").innerText = ethers.utils.formatUnits(staked, 18);
        document.getElementById("pendingReward").innerText = ethers.utils.formatEther(pending);
        document.getElementById("contractBalance").innerText = ethers.utils.formatEther(balance);
      } catch (error) {
        console.error(error);
        alert("Error fetching contract data.");
      }
    }

    // Stake tokens
    async function stakeTokens() {
      const amount = document.getElementById("stakeAmount").value;
      if (!amount || isNaN(amount)) {
        alert("Please enter a valid amount.");
        return;
      }
      try {
        const stakeAmount = ethers.utils.parseUnits(amount, 18); // Assuming 18 decimals
        const tx = await contract.stake(stakeAmount);
        await tx.wait();
        alert("Stake successful.");
        refreshData();
      } catch (error) {
        console.error(error);
        alert("Error staking tokens.");
      }
    }

    // Unstake tokens
    async function unstakeTokens() {
      const amount = document.getElementById("unstakeAmount").value;
      if (!amount || isNaN(amount)) {
        alert("Please enter a valid amount.");
        return;
      }
      try {
        const unstakeAmount = ethers.utils.parseUnits(amount, 18);
        const tx = await contract.unstake(unstakeAmount);
        await tx.wait();
        alert("Unstake successful.");
        refreshData();
      } catch (error) {
        console.error(error);
        alert("Error unstaking tokens.");
      }
    }

    // Claim reward
    async function claimReward() {
      try {
        const tx = await contract.claimReward();
        await tx.wait();
        alert("Reward claimed successfully.");
        refreshData();
      } catch (error) {
        console.error(error);
        alert("Error claiming reward.");
      }
    }

    // Emergency withdraw
    async function emergencyWithdraw() {
      try {
        const tx = await contract.emergencyWithdraw();
        await tx.wait();
        alert("Emergency withdraw successful.");
        refreshData();
      } catch (error) {
        console.error(error);
        alert("Error with emergency withdraw.");
      }
    }

    // Event listeners for buttons
    document.getElementById("connectWallet").addEventListener("click", connectWallet);
    document.getElementById("refreshData").addEventListener("click", refreshData);
    document.getElementById("stakeButton").addEventListener("click", stakeTokens);
    document.getElementById("unstakeButton").addEventListener("click", unstakeTokens);
    document.getElementById("claimRewardButton").addEventListener("click", claimReward);
    document.getElementById("emergencyWithdrawButton").addEventListener("click", emergencyWithdraw);
  </script>
</body>
</html>
