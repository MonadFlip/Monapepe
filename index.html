<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>StakeTokenETH DApp</title>
  <!-- Thư viện ethers.js -->
  <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { padding: 8px; margin: 5px 0; }
    .section { margin-bottom: 20px; }
  </style>
</head>
<body>
  <h1>StakeTokenETH DApp</h1>
  <button id="connectWallet">Kết nối ví</button>
  <div id="walletAddress"></div>

  <div class="section">
    <h2>Thông tin hợp đồng</h2>
    <button id="refreshData">Làm mới dữ liệu</button>
    <p>Số lượng đã stake: <span id="stakedAmount">0</span></p>
    <p>Phần thưởng đang chờ: <span id="pendingReward">0</span></p>
    <p>Số dư hợp đồng: <span id="contractBalance">0</span></p>
  </div>

  <div class="section">
    <h2>Chức năng</h2>
    <div>
      <h3>Stake Token</h3>
      <input type="number" id="stakeAmount" placeholder="Số lượng cần stake">
      <button id="stakeButton">Stake</button>
    </div>
    <div>
      <h3>Unstake Token</h3>
      <input type="number" id="unstakeAmount" placeholder="Số lượng cần unstake">
      <button id="unstakeButton">Unstake</button>
    </div>
    <div>
      <h3>Claim Reward</h3>
      <button id="claimRewardButton">Nhận thưởng</button>
    </div>
    <div>
      <h3>Emergency Withdraw</h3>
      <button id="emergencyWithdrawButton">Rút khẩn cấp</button>
    </div>
  </div>

  <script>
    let provider;
    let signer;
    let contract;
    let userAddress;

    // Thông tin hợp đồng
    const contractAddress = "YOUR_CONTRACT_ADDRESS"; // Thay bằng địa chỉ hợp đồng của bạn
    const abi = [
      "function stake(uint256 amount) external",
      "function unstake(uint256 amount) external",
      "function claimReward() external",
      "function emergencyWithdraw() external",
      "function pendingReward(address user) external view returns (uint256)",
      "function getStakedAmount(address user) external view returns (uint256)",
      "function contractBalance() external view returns (uint256)"
    ];

    // Kết nối ví MetaMask
    async function connectWallet() {
      if (window.ethereum) {
        try {
          await window.ethereum.request({ method: "eth_requestAccounts" });
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          userAddress = await signer.getAddress();
          document.getElementById("walletAddress").innerText = "Đã kết nối: " + userAddress;
          contract = new ethers.Contract(contractAddress, abi, signer);
          refreshData();
        } catch (error) {
          console.error(error);
          alert("Kết nối ví thất bại.");
        }
      } else {
        alert("Vui lòng cài đặt MetaMask.");
      }
    }

    // Lấy dữ liệu từ hợp đồng
    async function refreshData() {
      if (!contract || !userAddress) return;
      try {
        const staked = await contract.getStakedAmount(userAddress);
        const pending = await contract.pendingReward(userAddress);
        const balance = await contract.contractBalance();
        document.getElementById("stakedAmount").innerText = ethers.utils.formatUnits(staked, 18);
        document.getElementById("pendingReward").innerText = ethers.utils.formatEther(pending);
        document.getElementById("contractBalance").innerText = ethers.utils.formatEther(balance);
      } catch (error) {
        console.error(error);
        alert("Có lỗi khi lấy dữ liệu hợp đồng.");
      }
    }

    // Stake token
    async function stakeTokens() {
      const amount = document.getElementById("stakeAmount").value;
      if (!amount || isNaN(amount)) {
        alert("Vui lòng nhập số lượng hợp lệ.");
        return;
      }
      try {
        // Giả sử token có 18 chữ số thập phân
        const stakeAmount = ethers.utils.parseUnits(amount, 18);
        const tx = await contract.stake(stakeAmount);
        await tx.wait();
        alert("Stake thành công.");
        refreshData();
      } catch (error) {
        console.error(error);
        alert("Có lỗi khi stake token.");
      }
    }

    // Unstake token
    async function unstakeTokens() {
      const amount = document.getElementById("unstakeAmount").value;
      if (!amount || isNaN(amount)) {
        alert("Vui lòng nhập số lượng hợp lệ.");
        return;
      }
      try {
        const unstakeAmount = ethers.utils.parseUnits(amount, 18);
        const tx = await contract.unstake(unstakeAmount);
        await tx.wait();
        alert("Unstake thành công.");
        refreshData();
      } catch (error) {
        console.error(error);
        alert("Có lỗi khi unstake token.");
      }
    }

    // Claim reward
    async function claimReward() {
      try {
        const tx = await contract.claimReward();
        await tx.wait();
        alert("Nhận thưởng thành công.");
        refreshData();
      } catch (error) {
        console.error(error);
        alert("Có lỗi khi nhận thưởng.");
      }
    }

    // Emergency withdraw
    async function emergencyWithdraw() {
      try {
        const tx = await contract.emergencyWithdraw();
        await tx.wait();
        alert("Rút khẩn cấp thành công.");
        refreshData();
      } catch (error) {
        console.error(error);
        alert("Có lỗi khi rút khẩn cấp.");
      }
    }

    // Sự kiện click cho các nút
    document.getElementById("connectWallet").addEventListener("click", connectWallet);
    document.getElementById("refreshData").addEventListener("click", refreshData);
    document.getElementById("stakeButton").addEventListener("click", stakeTokens);
    document.getElementById("unstakeButton").addEventListener("click", unstakeTokens);
    document.getElementById("claimRewardButton").addEventListener("click", claimReward);
    document.getElementById("emergencyWithdrawButton").addEventListener("click", emergencyWithdraw);
  </script>
</body>
</html>
